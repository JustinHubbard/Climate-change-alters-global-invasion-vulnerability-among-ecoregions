
# R version 4.1.0 (2021-05-18)

# Code is associated with the following sections of the article

# Methods
# Terrestrial ecoregions raw shapefile does not have the each polygon of each ecoregion together as one object.
# The code below is put them together for each ecoregion. 

# clean working environment
rm(list=ls())

# load packages
library(raster)
library(sp)
library(rgdal)
library(proj4)
library(rgeos)

# Each if  statement provides a different resolution raster to produce the list of dataframes for each terrestrial 
terr.eco<-shapefile("wwf_terr_ecos.shp")
# Set projection
crs(terr.eco)<-"+proj=longlat +datum=WGS84 +no_defs" 
# Grab all the ecoregion codes
eco.names<-unique(terr.eco$ECO_NAME)

# Grabbing first observation, building on it then deleting the first observation is simpler than creating an empty one
terr.eco.org<-terr.eco[1,c("ECO_NAME", "BIOME", "AREA", "ECO_SYM", "eco_code", "REALM")] 

# Loop to aggregate all the shapefile assosiated with each ecoregion for easier use later
for(i in 1:length(eco.names)){
  temp.name<-eco.names[i]
  terr.eco.temp<-aggregate(terr.eco[terr.eco$ECO_NAME==temp.name,])
  # Retain the other possibly relevant info
  terr.eco.temp$ECO_NAME<-temp.name
  terr.eco.temp$BIOME<-terr.eco[terr.eco$ECO_NAME==temp.name,]$BIOME[1]
  terr.eco.temp$AREA<-terr.eco[terr.eco$ECO_NAME==temp.name,]$area_km2[1]
  terr.eco.temp$ECO_SYM<-terr.eco[terr.eco$ECO_NAME==temp.name,]$ECO_SYM[1]
  terr.eco.temp$eco_code<-terr.eco[terr.eco$ECO_NAME==temp.name,]$eco_code[1]
  terr.eco.temp$REALM<-terr.eco[terr.eco$ECO_NAME==temp.name,]$REALM[1]
  terr.eco.org<-rbind(terr.eco.org, terr.eco.temp)
}
terr.compiled<-terr.eco.org[-1,] #remove the first one because we used to create a SPDF to build on
# Save the final product (creates tempdir folder)
writeOGR(terr.compiled, dsn="tempdir", layer="teow", driver="ESRI Shapefile")
